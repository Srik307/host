<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <link rel="stylesheet"  href="driver.css" />
    </head>

  <body>
  <nav class="navbar">
  <div id="h1">&nbsp;<b>DRIVER LOCATION</b><div>
  <div><a id="h3" href="home.html">==>HOMEPAGE</a></div>
  </nav><br><br>
    <div id="map">
    </div>
   <div id=inputs>
    <h1 id="h2">Hello</h1><center>
   </div></center><br><br><br>
   <input type="number" id="busno"/>
    <input type="button" id="start" value="START" onclick="startt()"/>
    <input type="button" id="stop" value="STOP" onclick="stopp()"/>
   </div>
   </body>
  <script>
    var bus=L.icon({
      iconUrl:"icon31.png",
      iconSize:[30,30],
      iconAnchor:[15,15]
    })
    var myloc=L.icon({
      iconUrl:"mylocation.png",
      iconSize:[30,30],
      iconAnchor:[15,15]
    })
    var map = L.map('map').setView([12.9709819,80.0423042], 15);
    L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=J94sGuRVyXXwRgEQOHUG',{
      tileSize: 512,
      zoomOffset: -1,
      minZoom: 1,
      //attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
      crossOrigin: true
    }).addTo(map);
    //var busmarker=L.marker([12.9709819,80.0423042],{icon: bus}).addTo(map);
</script>


<script>
  const starbut=document.getElementById("start");
  const stopbut=document.getElementById("stop");
  var coord={};

  function locate(){
    if (navigator.geolocation) {
   window.navigator.geolocation.getCurrentPosition(showLocation, checkError);
    } else {
    alert("The browser does not support geolocation");
   }
  }

  //for error check
 function checkError(error) {
    switch (error.code) {
    case error.PERMISSION_DENIED:
      alert("Please allow access to location");
      break;
    case error.POSITION_UNAVAILABLE:
      alert("Location Information unavailable");
      break;
    case error.TIMEOUT:
      alert("The request to get user location timed out");
     }
 }

 const showLocation = async (position) => {
  lat=`${position.coords.latitude}`;
  lon=`${position.coords.longitude}`;
  coord=Object.assign({"lati":lat},coord);
  coord=Object.assign({"long":lon},coord);
  var mymarker=L.marker([lat,lon],{icon: myloc}).addTo(map);
  map.setView(new L.LatLng(lat,lon),13);
  console.log(coord);
  }


function startt(){
  starbut.style.display="none";
  stopbut.style.display="block";
  var j=1;
  document.getElementById('h2').textContent="STARTED";
  inter=setInterval(()=>{
  var busno= document.getElementById("busno").value
  coord=Object.assign({"bus":busno},coord);
  locate();
  ajx(coord);
  coord={};
  },2000);
}

function stopp(){
  clearInterval(inter);
  document.getElementById("h2").textContent="STOPPED";
  starbut.style.display="block";
  stopbut.style.display="none";
}

//AJAX REQUEST
  function ajx(coord){
  $.ajax({
        url:'http://localhost:8080/frontend/driverconnectgittest.php',
        type:'GET',
        data:coord,
        dataType:'JSON',  
        });
}

    </script>
</html>

