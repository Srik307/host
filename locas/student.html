<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <link rel="stylesheet" href="student.css"/>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
</head>

<body>
  <nav class="navbar">
   &nbsp;BUS LOCATION
  </nav>
  <br><br>

  <div id="map"> 
  </div>

  <div id="inputs">
      <br><br> 
      <h1 id="h2">Enter the Bus Number to Track</h1><br><br>
      <input type="number" name="busno" id="busno"/><br>
      <input type="button" id="start"  onclick="startt()" value="TRACK BUS"/><br><br>
      <input type="button" id="stop"  onclick="stopp()" value="STOP"/>
  </div>
</body>

<script>
    var bus=L.icon({
      iconUrl:"icons/31.png",
      iconSize:[30,30],
      iconAnchor:[15,15]
    })

    var map = L.map('map').setView([12.9709819,80.0423042], 15);
    //Maptiler API CALL
    L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=J94sGuRVyXXwRgEQOHUG',{
      tileSize: 512,
      zoomOffset: -1,
      minZoom: 1,
      crossOrigin: true
    }).addTo(map);

</script>

<script>

inter=null;
const startbut=document.getElementById('start');
const stopbut=document.getElementById('stop');
const status= document.getElementById("h2");

function startt(){
var busno=document.getElementById('busno').value;
status.textContent="STARTED TRACKING BUS "+busno;
ajx(busno);
startbut.style.display="none";
stopbut.style.display="block";

//Interval loop to constantly check bus loction
inter=setInterval(function(busno){
$(".leaflet-marker-icon").remove();
ajx(busno);
console.log(11);
},9000,busno);
}

function stopp(){
clearInterval(inter);//to stop interval loop
startbut.style.display="block";
stopbut.style.display="none";
status.textContent="STOPPED TRACKING";
}


//AJAX REQUEST
function ajx(busno){
  $.ajax({
        url:'studentconnect.php',
        type:'GET',
        data:{"bus": busno},
        dataType:'JSON',
        success: function(response){
        map.setView(new L.LatLng(response.latitude,response.longitude),14.5);
        var ico="icons/"+busno+".png";//setting the marker at derived coordinates
        var bus=L.icon({
         iconUrl:ico,
         iconSize:[30,30],
         iconAnchor:[15,15]
       })
        var mar=L.marker([response.latitude,response.longitude],{icon: bus}).addTo(map);
       }
    });
}

</script>
</html>

  